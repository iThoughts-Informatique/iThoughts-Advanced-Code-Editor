/**
 * @file Admin-specific functions for iThoughts Advanced Code Editor
 *
 * @copyright 2016 iThoughts Informatique
 * @license https://raw.githubusercontent.com/iThoughts-Informatique/iThoughts-Advanced-Code-Editor/master/LICENSE GPL3.0
 * @package ithoughts_advanced_code_editor
 *
 * @version 1.2.1
 */
$d.ready(function(){var e={wordpressEditors:{target:"#template #newcontent",container:"#template",preInit:function(e){e.clone=e.$elem[0].cloneNode(),e.$textarea=$(e.clone),e.$textarea.css({display:"none"});var t=qs('[name="file"]');if(t&&(e.language=t.value),e.language&&(e.language=e.language.replace(/^.+\.(\w+?)$/,"$1")),"php"==e.language){$("#template .submit").append('<p class="codecheck codecheck-php codecheck-on">CodeCheck</p>'),console.info("Sandboxing");var n=gei("submit");$("#template").submit(function(a){return"unchecked"==n.getAttribute("data-waschecked")?ithoughts_ace.sandboxPhp(e.$textarea.val(),t.value,a,n):void 0})}return e},postInit:function(e,t){return"php"==t.language&&e.on("change",function(){submit.setAttribute("data-waschecked","unchecked")}),t.$container&&t.$container.css({position:"relative"}),t.$parent.append(t.$textarea),function(){window.matchMedia("(max-width:783px)").matches?t.$container.css({marginRight:0}):t.$container.css({marginRight:200});var n={top:$w.scrollTop()+32,bottom:$w.scrollTop()+$w.height()},a=t.$container.offset().top-(parseInt(t.$container.css("top"))||0),o=Math.max(0,n.top-a);t.$container.css({top:o});var i=n.bottom-Math.max(a,n.top),r=t.$container.height()-t.$editorContainer.height(),c=i-r-(parseFloat($("#template p.submit").css("margin-bottom"))||0);t.$editorContainer.height(c),e.resize()}}},ithoughtsHTMLSnippets:{target:"body.post-type-html_snippet #wp-content-editor-container",container:"#wp-content-editor-container",preInit:function(e){return e.language="php",e.$textarea=$("#content").clone(),e.$textarea.css({display:"none"}),e.$parent.append(e.$textarea).prepend($.parseHTML('<div id="ed_toolbar"></div>')),$("#wp-content-editor-tools").remove(),e},postInit:function(e,t){t.editorContainer.classList.add("ithoughts_ace-postcontent"),t.editorContainer.classList.add("mce-edit-area"),t.editorContainer.style.height="388px",t.$container.css({marginTop:20}),e.resize()}},WpAllImport:{target:"#wp_all_import_code",container:"#wp_all_import_code",preInit:function(e){e.$textarea=$(".CodeMirror.cm-s-default"),e.$textarea.hide();var t=$(".CodeMirror.cm-s-default")[0].CodeMirror;return e.$textarea.val=function(e){t.doc.setValue(e)},e.language="php",e}}};if(ithoughts_ace.ignoreReplacement&&"Array"==ithoughts_ace.ignoreReplacement.constructor.name&&ithoughts_ace.ignoreReplacement.length>0)for(var t=0,n=ithoughts_ace.ignoreReplacement.length;n>t;t++)e[ithoughts_ace.ignoreReplacement[t]]&&delete e[ithoughts_ace.ignoreReplacement[t]];if(window.replacedEditors&&"Object"==window.replacedEditors.constructor.name)for(var a in e)"undefined"==typeof window.replacedEditors[a]&&(window.replacedEditors[a]=e[a]);else window.replacedEditors=e;for(var a in window.replacedEditors)!function(){console.log("Init type",a);var e=window.replacedEditors[a],t={};if(t.$elem=$(e.target),1==t.$elem.length){t.$parent=t.$elem.parent(),t.$container=$(e.container),t.$container.length>0?t.$container=$(t.$container[0]):t.$container={},"undefined"!=typeof e.preInit&&null!=e.preInit&&"Function"==e.preInit.constructor.name&&(t=e.preInit(t));var n=ace.edit(t.$elem[0].id);ithoughts_ace.setAceOpts(n,t.language,t),t.editorContainer=n.container,t.$editorContainer=$(t.editorContainer);var o=null;"undefined"!=typeof e.postInit&&null!=e.postInit&&"Function"==e.postInit.constructor.name&&(o=e.postInit(n,t)),t.$textarea&&t.$textarea.length>0&&n.getSession().on("change",function(){t.$textarea.val(n.getSession().getValue())}),"undefined"!=typeof o&&null!=o&&"Function"==o.constructor.name&&$w.resize(o).scroll(o).scroll()}}()}),ithoughts_ace.sandboxPhp=function(e,t,n,a,o){function i(e){try{e&&"String"==e.constructor.name&&(e=JSON.parse(e)),$("#checkresult").remove();var t=["notice"];e.success&&e.data&&e.data.text?t.push("notice-success"):t.push("notice-error"),$("#submit").parent().css({display:"inline-block",width:"auto"}).parent().append($.parseHTML('<div id="checkresult" class="'+t.join(" ")+'">'+(e.data&&e.data.text?e.data.text:"<p>Could not parse server response</p>")+"</div>")),e.success&&e.data&&e.data.text?(a.setAttribute("data-waschecked","checked-valid"),$(a).click()):a.setAttribute("data-waschecked","checked-invalid")}catch(n){$("#submit").parent().css({display:"inline-block",width:"auto"}).parent().append($.parseHTML('<div id="checkresult" class="notice notice-error"><p>Could not parse server response</p></div>'))}}return console.log(o),$.post(ithoughts_ace.ajax,{code:e,file:t,action:"ithoughts_ace_check_syntax"}).success(function(e){i(e)}).fail(function(e){i(e)}),n.preventDefault(),!1};