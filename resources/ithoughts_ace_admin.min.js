/**
 * @file Admin-specific functions for iThoughts Advanced Code Editor
 *
 * @author Gerkin
 * @copyright 2016 iThoughts Informatique
 * @license https://raw.githubusercontent.com/iThoughts-Informatique/iThoughts-Advanced-Code-Editor/master/LICENSE GPL3.0
 * @package ithoughts_advanced_code_editor
 *
 * @version 1.2.10
 */
!function(e){"use strict";function t(e){var t=('{"'+decodeURI(e).replace(/"/g,'\\"').replace(/&/g,'","').replace(/=/g,'":"')+'"}').replace(/([\{,]"[^"]*?"(?=[,\}]))/g,"$1:true");try{return JSON.parse(t)}catch(n){return console.warn("Could not parse query string:",t,n),{}}}var n=(ithoughts_ace,e.$),a=e.$w;e.$d.ready(function(){var o={wordpressEditors:{target:"#template #newcontent",container:"#template",preInit:function(t){n("#scrollto").attr("id","_scrollto"),t.clone=t.$elem[0].cloneNode(),t.$textarea=n(t.clone),t.$textarea.css({display:"none"});var a=e.qs('[name="file"]');return a&&(t.language=a.value),t.language&&(t.language=t.language.replace(/^.+\.(\w+?)$/,"$1")),"php"==t.language&&(n("#template .submit").append('<p class="codecheck codecheck-php codecheck-on">CodeCheck</p>'),console.info("Sandboxing"),t.submit=e.gei("submit"),t.submit&&n("#template").submit(function(e){return"unchecked"==t.submit.getAttribute("data-waschecked")?ithoughts_ace.sandboxPhp(t,a.value,e,submit):void 0})),t},postInit:function(e,t){return"php"==t.language&&e.on("change",function(){t.submit&&t.submit.setAttribute("data-waschecked","unchecked")}),t.$container&&t.$container.css({position:"relative"}),t.$parent.append(t.$textarea),function(){window.matchMedia("(max-width:783px)").matches?t.$container.css({marginRight:0}):t.$container.css({marginRight:200});var o={top:a.scrollTop()+32,bottom:a.scrollTop()+a.height()},r=t.$container.offset().top-(parseInt(t.$container.css("top"))||0),i=Math.max(0,o.top-r);t.$container.css({top:i});var c=o.bottom-Math.max(r,o.top),s=t.$container.height()-t.$editorContainer.height(),l=c-s-(parseFloat(n("#template p.submit").css("margin-bottom"))||0);t.$editorContainer.height(l),e.resize()}}},ithoughtsHTMLSnippets:{target:"body.post-type-html_snippet #wp-content-editor-container",container:"#wp-content-editor-container",preInit:function(e){return e.language="php",e.$textarea=n("#content").clone(),e.$textarea.css({display:"none"}),e.$parent.append(e.$textarea).prepend(n.parseHTML('<div id="ed_toolbar"></div>')),n("#wp-content-editor-tools").remove(),e},postInit:function(e,t){t.editorContainer.classList.add("ithoughts_ace-postcontent"),t.editorContainer.classList.add("mce-edit-area"),t.editorContainer.style.height="388px",t.$container.css({marginTop:20}),e.resize()}},WpAllImport:{target:"#wp_all_import_code",container:"#wp_all_import_code",preInit:function(e){e.$textarea=n(".CodeMirror.cm-s-default"),e.$textarea.hide();var t=n(".CodeMirror.cm-s-default")[0].CodeMirror;return e.$textarea.val=function(e){t.doc.setValue(e)},e.language="php",e}}};if(ithoughts_ace.ignoreReplacement&&"Array"==ithoughts_ace.ignoreReplacement.constructor.name&&ithoughts_ace.ignoreReplacement.length>0)for(var r=0,i=ithoughts_ace.ignoreReplacement.length;i>r;r++)o[ithoughts_ace.ignoreReplacement[r]]&&delete o[ithoughts_ace.ignoreReplacement[r]];if(window.replacedEditors&&"Object"==window.replacedEditors.constructor.name)for(var c in o)"undefined"==typeof window.replacedEditors[c]&&(window.replacedEditors[c]=o[c]);else window.replacedEditors=o;for(var c in window.replacedEditors)!function(){console.log("Init type",c);var e=window.replacedEditors[c],o={};if(o.$elem=n(e.target),1==o.$elem.length){o.$parent=o.$elem.parent(),o.$container=n(e.container),o.$container.length>0?o.$container=n(o.$container[0]):o.$container={},"undefined"!=typeof e.preInit&&null!=e.preInit&&"Function"==e.preInit.constructor.name&&(o=e.preInit(o));var r=ace.edit(o.$elem[0].id);ithoughts_ace.setAceOpts(r,o.language,o),o.editorContainer=r.container,o.$editorContainer=n(o.editorContainer),o.editor=r;var i=t(location.search.substring(1));"undefined"!=typeof i.scrollto&&null!=i.scrollto&&r.scrollToLine(i.scrollto);var s=null;"undefined"!=typeof e.postInit&&null!=e.postInit&&"Function"==e.postInit.constructor.name&&(s=e.postInit(r,o));var l=n('[name="scrollto"]');o.$textarea&&o.$textarea.length>0&&r.getSession().on("change",function(){l.val(r.getSelectionRange().start.row),o.$textarea.val(r.getSession().getValue())}),"undefined"!=typeof s&&null!=s&&"Function"==s.constructor.name&&a.resize(s).scroll(s).scroll()}}()}),"undefined"==typeof ithoughts_ace&&(ithoughts_ace={}),ithoughts_ace.sandboxPhp=function(e,t,a,o,r){function i(e){n("#ithoughts_ace-loader").remove(),e===!0&&n(".submit").append(n.parseHTML('<div id="ithoughts_ace-loader"></div>'))}function c(e){i(!1);try{e&&"String"==e.constructor.name&&(e=JSON.parse(e)),n("#checkresult").remove();var t=["notice"];e.success&&e.data&&e.data.text?t.push("notice-success"):t.push("notice-error"),n("#submit").parent().css({display:"inline-block",width:"auto"}).parent().append(n.parseHTML('<div id="checkresult" class="'+t.join(" ")+'">'+(e.data&&e.data.text?e.data.text:"<p>Could not parse server response</p>")+"</div>")),e.success&&e.data&&e.data.text?(o.setAttribute("data-waschecked","checked-valid"),n(o).click()):o.setAttribute("data-waschecked","checked-invalid")}catch(a){n("#submit").parent().css({display:"inline-block",width:"auto"}).parent().append(n.parseHTML('<div id="checkresult" class="notice notice-error"><p>Could not parse server response</p></div>'))}}return console.log(r,e),i(!0),n.post(ithoughts_ace.ajax+"?"+n.param(params),{code:e.$textarea.val(),file:t,action:"ithoughts_ace_check_syntax"}).success(function(e){c(e)}).fail(function(e){c(e)}),a.preventDefault(),!1}}(Ithoughts.v3);